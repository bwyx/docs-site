<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CI/CD Using Digger</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.7ef1da3e.css" as="style"><link rel="preload" href="/assets/js/app.cab291b9.js" as="script"><link rel="preload" href="/assets/js/2.4167c022.js" as="script"><link rel="preload" href="/assets/js/8.110afd94.js" as="script"><link rel="prefetch" href="/assets/js/10.0b38547d.js"><link rel="prefetch" href="/assets/js/11.4082ef0e.js"><link rel="prefetch" href="/assets/js/12.4d64877d.js"><link rel="prefetch" href="/assets/js/13.c5a7f934.js"><link rel="prefetch" href="/assets/js/14.8a039fda.js"><link rel="prefetch" href="/assets/js/15.7a637679.js"><link rel="prefetch" href="/assets/js/16.6e704ef5.js"><link rel="prefetch" href="/assets/js/17.3b20d3fc.js"><link rel="prefetch" href="/assets/js/18.4768cedc.js"><link rel="prefetch" href="/assets/js/3.22b45f90.js"><link rel="prefetch" href="/assets/js/4.a1a0064b.js"><link rel="prefetch" href="/assets/js/5.536ca2b6.js"><link rel="prefetch" href="/assets/js/6.0d1fdda2.js"><link rel="prefetch" href="/assets/js/7.e542ad6f.js"><link rel="prefetch" href="/assets/js/9.e1480606.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7ef1da3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/digger-logo-text.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#what-is-digger" class="sidebar-link">What is Digger</a></li><li class="sidebar-sub-header"><a href="/#how-it-works" class="sidebar-link">How it works</a></li></ul></li><li><a href="/overview/concepts.html" class="sidebar-link">Concepts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/overview/concepts.html#project" class="sidebar-link">Project</a></li><li class="sidebar-sub-header"><a href="/overview/concepts.html#service" class="sidebar-link">Service</a></li><li class="sidebar-sub-header"><a href="/overview/concepts.html#environment" class="sidebar-link">Environment</a></li></ul></li><li><a href="/overview/digger-vs-other.html" class="sidebar-link">Digger vs Other</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#heroku-and-other-paas" class="sidebar-link">Heroku and other PaaS</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#netlify-vercel-firebase-hosting" class="sidebar-link">Netlify, Vercel, Firebase Hosting</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#aws-lightsail" class="sidebar-link">AWS Lightsail</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#aws-elasticbeanstalk" class="sidebar-link">AWS ElasticBeanstalk</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#aws-copilot" class="sidebar-link">AWS Copilot</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#google-cloud-run" class="sidebar-link">Google Cloud Run</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#terraform-cloudformation-pulumi-and-iac" class="sidebar-link">Terraform, Cloudformation, Pulumi and IaC</a></li><li class="sidebar-sub-header"><a href="/overview/digger-vs-other.html#kubernetes" class="sidebar-link">Kubernetes</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/getting-started/installation.html" class="sidebar-link">Install Digger CLI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/getting-started/installation.html#homebrew" class="sidebar-link">Homebrew</a></li><li class="sidebar-sub-header"><a href="/getting-started/installation.html#npm" class="sidebar-link">NPM</a></li><li class="sidebar-sub-header"><a href="/getting-started/installation.html#direct-download" class="sidebar-link">Direct download</a></li><li class="sidebar-sub-header"><a href="/getting-started/installation.html#using-docker" class="sidebar-link">Using Docker</a></li><li class="sidebar-sub-header"><a href="/getting-started/installation.html#test-that-it-works" class="sidebar-link">Test that it works</a></li></ul></li><li><a href="/getting-started/cicd.html" aria-current="page" class="active sidebar-link">CI/CD Using Digger</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/getting-started/cicd.html#github-actions" class="sidebar-link">Github Actions</a></li><li class="sidebar-sub-header"><a href="/getting-started/cicd.html#gitlab-ci" class="sidebar-link">Gitlab CI</a></li></ul></li><li><a href="/getting-started/node-express.html" class="sidebar-link">Run a Node.js app</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/getting-started/django.html" class="sidebar-link">Run a Django app</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reference-cli.html" class="sidebar-link">CLI reference</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-auth" class="sidebar-link">dg auth</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-project-init" class="sidebar-link">dg project init</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-sync" class="sidebar-link">dg sync</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-service-add" class="sidebar-link">dg service add</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-build-env-name" class="sidebar-link">dg env build env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-push-env-name" class="sidebar-link">dg env push env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-release-env-name" class="sidebar-link">dg env release env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-create-env-name" class="sidebar-link">dg env create env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-plan-env-name" class="sidebar-link">dg env plan env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-apply-env-name" class="sidebar-link">dg env apply env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-update-env-name" class="sidebar-link">dg env update env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-destroy-env-name" class="sidebar-link">dg env destroy env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-describe-env-name" class="sidebar-link">dg env describe env_name</a></li><li class="sidebar-sub-header"><a href="/reference-cli.html#dg-env-list" class="sidebar-link">dg env list</a></li></ul></li><li><a href="/reference-yaml.html" class="sidebar-link">digger.yml reference</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reference-yaml.html#structure" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/reference-yaml.html#defining-resource-dependencies" class="sidebar-link">Defining Resource dependencies</a></li><li class="sidebar-sub-header"><a href="/reference-yaml.html#using-existing-resources" class="sidebar-link">Using existing resources</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/misc/tagging-and-rollbacks.html" class="sidebar-link">Image tagging rollbacks</a></li><li><a href="/misc/composing-terraform-templates.html" class="sidebar-link">Terraform Templates</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ci-cd-using-digger"><a href="#ci-cd-using-digger" class="header-anchor">#</a> CI/CD Using Digger</h1> <p>You can use digger CLI within your CI/CD pipeline within your favourite tools such as Github Actions, CircliCI or TravicCI. Digger CLI <code>dg</code> can easily be used within your CI system to support your releasing. All you need is your digger token and AWS keys and then you can follow the system of your choise</p> <h2 id="github-actions"><a href="#github-actions" class="header-anchor">#</a> Github Actions</h2> <p>In the snippet bellow we show an example of a github action which will release your service <code>svc1</code> on push. You can see a full GH workflow example in our <a href="https://github.com/diggerhq/django-todolist/blob/master/.github/workflows/deploy.yml" target="_blank" rel="noopener noreferrer">TODO example repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>name: Digger CI
on:
  push:
    branches: [master]


  build-push-release:
    runs-on: ubuntu-16.04
    needs:
      - get_tag_version
    steps:
    - name: Checkout
      uses: actions/checkout@v1

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: eu-west-1

    - name: Set up Python 3.8
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'

    - name: Build and push and release
      env:
        DIGGER_TOKEN: ${{ secrets.DIGGER_TOKEN }}
        DIGGER_AWS_KEY: ${{ secrets.DIGGER_AWS_KEY }}
        DIGGER_AWS_SECRET: ${{ secrets.DIGGER_AWS_SECRET }}
        BACKEND_ENDPOINT: &quot;https://backend.digger.dev&quot;
        WEBAPP_ENDPOINT: &quot;https://app.digger.dev&quot;
      run: |
        export TAG_VERSION=${{needs.get_tag_version.outputs.tag_version}} 

        # Install diggercli
        pip install --upgrade git+https://github.com/diggerhq/cli@master

        echo &quot;&gt; Building docker image&quot;
        dg env build stage --service svc1
        echo &quot;&gt; Pushing docker image to ECR&quot;    
        dg env push stage --service svc1 --aws-key &quot;$DIGGER_AWS_KEY&quot; --aws-secret &quot;$DIGGER_AWS_SECRET&quot;
        echo &quot;&gt; Releasing&quot;    
        dg env push release --service svc1 --aws-key &quot;$DIGGER_AWS_KEY&quot; --aws-secret &quot;$DIGGER_AWS_SECRET&quot;

</code></pre></div><h2 id="gitlab-ci"><a href="#gitlab-ci" class="header-anchor">#</a> Gitlab CI</h2> <p>In the snippet bellow we show an example of a gitlab ci. We are using the offical docker image of digger to run digger commands. This comes with all dg dependencies included in the image</p> <div class="language- extra-class"><pre class="language-text"><code>default:
  image: public.ecr.aws/g1x6q1x1/dg:v0.2.17


variables:
  # You need to configure the following variables as gitlab secrets
  # DIGGER_TOKEN: ${{DIGGER_TOKEN}}
  # DIGGER_AWS_KEY: ${{ secrets.DIGGER_AWS_KEY }}
  # DIGGER_AWS_SECRET: ${{ secrets.DIGGER_AWS_SECRET }}
  BACKEND_ENDPOINT: &quot;https://backend.digger.dev&quot;
  WEBAPP_ENDPOINT: &quot;https://app.digger.dev&quot;
  SERVICE: platform
  TAG_VERSION: $CI_COMMIT_SHORT_SHA
  # settings for docker-in-docker
  DOCKER_HOST: tcp://docker:2376
  DOCKER_TLS_CERTDIR: &quot;/certs&quot;
  DOCKER_TLS_VERIFY: 1
  DOCKER_CERT_PATH: &quot;$DOCKER_TLS_CERTDIR/client&quot;
  
# This is needed to allow docker-in-docker
services:
  - docker:19.03.12-dind

release-staging:
  stage: build
  variables:
    # This is the name of your environment
    DG_ENV: &quot;staging&quot; 
  only:
    - develop
  script:
    - echo &quot;&gt; Building docker image&quot;
    - dg env build &quot;$DG_ENV&quot; --service $SERVICE --tag $TAG_VERSION --context .
    - echo &quot;&gt; Pushing docker image to ECR&quot;
    - dg env push &quot;$DG_ENV&quot; --service $SERVICE --tag $TAG_VERSION --aws-key &quot;$DIGGER_AWS_KEY&quot; --aws-secret &quot;$DIGGER_AWS_SECRET&quot;
    - echo &quot;&gt; Releasing docker image&quot;
    - dg env release &quot;$DG_ENV&quot; --service $SERVICE --tag $TAG_VERSION --aws-key &quot;$DIGGER_AWS_KEY&quot; --aws-secret &quot;$DIGGER_AWS_SECRET&quot;
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/getting-started/installation.html" class="prev">
        Install Digger CLI
      </a></span> <span class="next"><a href="/getting-started/node-express.html">
        Run a Node.js app
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cab291b9.js" defer></script><script src="/assets/js/2.4167c022.js" defer></script><script src="/assets/js/8.110afd94.js" defer></script>
  </body>
</html>
